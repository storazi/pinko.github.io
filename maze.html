<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸŒ€ ëœë¤ ë¯¸ë¡œ ê²Œì„</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #0b1426;
  color: #eaf2ff;
  font-family: "Pretendard", sans-serif;
  text-align: center;
}

/* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
.game-box {
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  padding-top: 60px;
  padding-bottom: 80px;
  position: relative;
}

/* ì œëª© */
.header {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 50;
}

.header h1 {
  margin: 0;
  font-size: 20px;
  color: #ffd447;
}

#generateBtn {
  padding: 6px 14px;
  border-radius: 8px;
  border: none;
  background: #ffd447;
  color: #1a1300;
  font-weight: 700;
  cursor: pointer;
}
#generateBtn:hover { opacity: 0.9; }

/* ë¯¸ë¡œ ìº”ë²„ìŠ¤ */
#mazeCanvas {
  width: 100%;
  height: auto;
  background: #0a1225;
  border-radius: 8px;
}

/* ì¡°ì´ìŠ¤í‹± */
#joystick {
  position: fixed;
  bottom: 70px;
  left: 40px;
  width: 140px;
  height: 140px;
  background: rgba(255,255,255,0.07);
  border: 2px solid rgba(255,255,255,0.15);
  border-radius: 50%;
  touch-action: none;
  z-index: 999;
}
#stick {
  position: absolute;
  width: 60px;
  height: 60px;
  background: rgba(255,212,71,0.85);
  border-radius: 50%;
  left: 40px;
  top: 40px;
  transition: 0.05s;
  touch-action: none;
}

/* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
.guide {
  margin-top: 14px;
  font-size: 12px;
  color: #9aa7c3;
}
</style>
</head>

<body>

<div class="game-box">

  <div class="header">
    <h1>ğŸŒ€ ëœë¤ ë¯¸ë¡œ ê²Œì„</h1>
    <button id="generateBtn">ğŸ”„ ìƒˆ ë¯¸ë¡œ</button>
  </div>

  <canvas id="mazeCanvas"></canvas>

  <div class="guide">
    WASD / ë°©í–¥í‚¤ / ëª¨ë°”ì¼ ì¡°ì´ìŠ¤í‹± ì§€ì›
  </div>
</div>

<!-- ëª¨ë°”ì¼ ì¡°ì´ìŠ¤í‹± -->
<div id="joystick"><div id="stick"></div></div>


<script>
const canvas = document.getElementById("mazeCanvas");
const ctx = canvas.getContext("2d");

let rows = 25;
let cols = 25;
let cellSize = 20;

let grid = [];
let stack = [];
let player = { r: 0, c: 0 };
let exit = { r: rows - 1, c: cols - 1 };

// ìº”ë²„ìŠ¤ ìë™ ë†’ì´ ê³„ì‚°
function resizeCanvas() {
  const box = document.querySelector(".game-box");
  canvas.width = box.clientWidth;

  cellSize = Math.floor(canvas.width / cols);
  if (cellSize < 8) cellSize = 8;

  canvas.height = cellSize * rows + 2;

  drawMaze();
}

window.addEventListener("resize", resizeCanvas);

// ì…€ ìƒì„±
class Cell {
  constructor(r, c) {
    this.r = r;
    this.c = c;
    this.walls = { top: true, right: true, bottom: true, left: true };
    this.visited = false;
  }

  draw() {
    const x = this.c * cellSize;
    const y = this.r * cellSize;

    ctx.strokeStyle = "#eaf2ff";
    ctx.lineWidth = 2;

    if (this.walls.top)    drawLine(x, y, x + cellSize, y);
    if (this.walls.right)  drawLine(x + cellSize, y, x + cellSize, y + cellSize);
    if (this.walls.bottom) drawLine(x, y + cellSize, x + cellSize, y + cellSize);
    if (this.walls.left)   drawLine(x, y, x, y + cellSize);
  }
}

function drawLine(x1,y1,x2,y2){
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x2,y2);
  ctx.stroke();
}

// ë¯¸ë¡œ ìƒì„±
function generateMaze() {
  grid = [];
  stack = [];

  for (let r = 0; r < rows; r++) {
    let row = [];
    for (let c = 0; c < cols; c++) row.push(new Cell(r, c));
    grid.push(row);
  }

  let current = grid[0][0];
  current.visited = true;
  stack.push(current);

  while (stack.length) {
    let next = checkNeighbors(current);

    if (next) {
      next.visited = true;
      stack.push(current);
      removeWalls(current, next);
      current = next;
    } else {
      current = stack.pop();
    }
  }
}

function checkNeighbors(cell) {
  let list = [];
  let { r, c } = cell;

  if (r > 0 && !grid[r-1][c].visited) list.push(grid[r-1][c]);
  if (c < cols-1 && !grid[r][c+1].visited) list.push(grid[r][c+1]);
  if (r < rows-1 && !grid[r+1][c].visited) list.push(grid[r+1][c]);
  if (c > 0 && !grid[r][c-1].visited) list.push(grid[r][c-1]);

  return list.length ? list[Math.floor(Math.random()*list.length)] : undefined;
}

function removeWalls(a, b) {
  let dx = a.c - b.c;
  let dy = a.r - b.r;

  if (dx === 1) { a.walls.left = false; b.walls.right = false; }
  if (dx === -1) { a.walls.right = false; b.walls.left = false; }
  if (dy === 1) { a.walls.top = false; b.walls.bottom = false; }
  if (dy === -1) { a.walls.bottom = false; b.walls.top = false; }
}

// ê·¸ë¦¬ê¸°
function drawMaze() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  grid.forEach(row => row.forEach(cell => cell.draw()));

  drawCircle(player.c * cellSize + cellSize/2, player.r * cellSize + cellSize/2, cellSize/3, "#68c3ff");
  drawCircle(exit.c   * cellSize + cellSize/2, exit.r   * cellSize + cellSize/2, cellSize/3, "#ffd447");
}

function drawCircle(x,y,r,color){
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fillStyle = color;
  ctx.fill();
}

// ì´ë™
document.addEventListener("keydown", (e)=>{
  let cell = grid[player.r][player.c];

  if ((e.key==="w"||e.key==="ArrowUp")    && !cell.walls.top)    player.r--;
  if ((e.key==="s"||e.key==="ArrowDown")  && !cell.walls.bottom) player.r++;
  if ((e.key==="a"||e.key==="ArrowLeft")  && !cell.walls.left)   player.c--;
  if ((e.key==="d"||e.key==="ArrowRight") && !cell.walls.right)  player.c++;

  drawMaze();
  checkWin();
});

function checkWin(){
  if (player.r === exit.r && player.c === exit.c) {
    setTimeout(()=> alert("ğŸ‰ ë¯¸ê¶ íƒˆì¶œ ì„±ê³µ!"), 40);
  }
}

// ì´ˆê¸°í™”
function newGame(){
  generateMaze();
  player = { r:0, c:0 };
  exit = { r:rows-1, c:cols-1 };
  resizeCanvas();
}

document.getElementById("generateBtn").onclick = newGame;

// ì¡°ì´ìŠ¤í‹±
const joy = document.getElementById("joystick");
const stick = document.getElementById("stick");

let dragging = false;
let center = { x:0, y:0 };

function simulateKey(k){
  document.dispatchEvent(new KeyboardEvent("keydown",{ key:k }));
}

joy.addEventListener("pointerdown", e=>{
  dragging = true;
  center = {
    x: joy.offsetLeft + joy.offsetWidth/2,
    y: joy.offsetTop + joy.offsetHeight/2
  };
});

document.addEventListener("pointermove", e=>{
  if(!dragging) return;

  let dx = e.clientX - center.x;
  let dy = e.clientY - center.y;

  let dist = Math.sqrt(dx*dx + dy*dy);
  let max = 40;
  if (dist > max){
    dx = dx/dist * max;
    dy = dy/dist * max;
  }

  stick.style.left = `${40 + dx}px`;
  stick.style.top  = `${40 + dy}px`;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 10) simulateKey("d");
    if (dx < -10) simulateKey("a");
  } else {
    if (dy > 10) simulateKey("s");
    if (dy < -10) simulateKey("w");
  }
});

document.addEventListener("pointerup", ()=>{
  dragging=false;
  stick.style.left="40px";
  stick.style.top="40px";
});

// ì‹¤í–‰
setTimeout(()=> newGame(), 100);
</script>

</body>
</html>
